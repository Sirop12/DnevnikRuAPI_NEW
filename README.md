# Документация по модулю DnevnikFormatter
[СВЯЗЬ](https://t.me/Sirop1)
[ПОЛУЧИТЬ ТОКЕН](https://androsovpavel.pythonanywhere.com/)
## СКОРО
 - Автоматическая регистрация через госуслуги
 - Асинхронная работа
 - Расширенная статистика по классам по школе
 - тг бот??

## Обзор
Модуль `DnevnikFormatter` — это Python-класс для работы с API Дневник.ру (Работает в регионах, где регистрация через госуслуги). Он упрощает получение и анализ данных об уроках, оценках и успеваемости школьников. Класс предназначен для родителей, учителей или администраторов, которые хотят быстро получить расписание, оценки, рейтинги учеников или статистику класса.

НА БАЗЕ [DnevnikRuAPI](https://github.com/kesha1225/DnevnikRuAPI)


Основные возможности:
- Получение расписания уроков на день.
- Просмотр оценок ученика за период.
- Вычисление средних баллов за четверть.
- Составление рейтинга класса или по предмету.
- Анализ статистики оценок по предметам и классу.

Модуль использует токен API для доступа к данным и автоматически кэширует предметы и учеников, чтобы ускорить работу.

## Установка
1. Установите библиотеку `pydnevnikruapi`:
   ```bash
   pip install pydnevnikruapi
   ```
2. Сохраните модуль в файл `dnevnik_formatter.py` (код предоставлен отдельно).
3. [Получите токен API Дневник.ру](https://github.com/kesha1225/DnevnikRuAPI)
   - Пример токена: `03dmDFj3njJsad3fdsfs`.

**Зависимости**:
- Python 3.6+.
- Библиотека `pydnevnikruapi`.
- Для визуализации данных (опционально): `matplotlib`, `pandas`.

## Начало работы
1. Импортируйте класс и создайте объект, указав токен:
   ```python
   from dnevnik_formatter import DnevnikFormatter
   formatter = DnevnikFormatter(token="03dmDFj3njJsad3fdsfs")
   ```
2. Используйте методы для получения данных (см. раздел "Методы").

**Примечание**: Токен должен иметь доступ к данным класса. Токен ученика может не видеть оценки других учеников — в этом случае используйте токен родителя или учителя.

## Методы
Класс `DnevnikFormatter` предоставляет следующие публичные методы. Каждый метод описан с назначением, параметрами, возвращаемыми данными и примером.

### 1. get_formatted_schedule
**Назначение**: Возвращает расписание уроков на указанный день, включая время, предмет, тему, домашнее задание и преподавателя.

**Параметры**:
| Параметр | Тип           | Описание                          |
|----------|---------------|-----------------------------------|
| `date`   | `datetime`    | Дата для расписания (например, `datetime(2025, 5, 16)`) |

**Возвращает**:
- Список словарей, где каждый словарь описывает урок:
  - `time`: время урока (например, "08:30-09:15").
  - `subject`: название предмета (например, "Биология").
  - `title`: тема урока.
  - `homework`: домашнее задание (или "Нет задания").
  - `teacher`: имя преподавателя.

**Пример**:
```python
from datetime import datetime
schedule = formatter.get_formatted_schedule(datetime(2025, 5, 16))
for lesson in schedule:
    print(f"{lesson['time']} - {lesson['subject']}: {lesson['homework']}")
```
**Вывод**:
```
08:30-09:15 - Биология: Прочитать §12
09:20-10:05 - Информатика: Решить задачи 1-3
```

### 2. get_formatted_marks
**Назначение**: Возвращает все оценки ученика за указанный период по предметам.

**Параметры**:
| Параметр      | Тип           | Описание                              |
|---------------|---------------|---------------------------------------|
| `start_date`  | `datetime`    | Начало периода (например, `datetime(2025, 1, 9)`) |
| `end_date`    | `datetime`, необязательно | Конец периода (по умолчанию равен `start_date`) |

**Возвращает**:
- Словарь, где ключи — названия предметов, а значения — списки оценок. Каждая оценка — словарь:
  - `date`: дата оценки (например, "09.01.2025").
  - `value`: оценка (например, "5" или "отлично").
  - `comment`: комментарий (или пустая строка).

**Пример**:
```python
from datetime import datetime
marks = formatter.get_formatted_marks(datetime(2025, 1, 9), datetime(2025, 1, 15))
for subject, grades in marks.items():
    print(f"{subject}:")
    for grade in grades:
        print(f"  {grade['date']} - {grade['value']}")
```
**Вывод**:
```
Биология:
  10.01.2025 - 4
  12.01.2025 - 5
Информатика:
  11.01.2025 - 3
```

### 3. get_formatted_final_marks
**Назначение**: Вычисляет средние баллы по предметам за четверть для одного ученика.

**Параметры**:
| Параметр      | Тип   | Описание                              |
|---------------|-------|---------------------------------------|
| `study_year`  | `int` | Учебный год (например, 2024 для 2024-2025) |
| `quarter`     | `int` | Номер четверти (1, 2, 3 или 4)        |

**Возвращает**:
- Список словарей, где каждый словарь описывает предмет:
  - `название предмета`: название (например, "Биология").
  - `оценки`: список числовых оценок.
  - `итог`: средний балл (например, "4.5") или "Нет оценок".

**Пример**:
```python
final_marks = formatter.get_formatted_final_marks(2024, 3)
for subject in final_marks:
    print(f"{subject['название предмета']}: {subject['итог']}")
```
**Вывод**:
```
Биология: 4.5
Информатика: 3.8
Математика: Нет оценок
```

### 4. get_class_ranking
**Назначение**: Составляет рейтинг учеников класса по среднему баллу за четверть.

**Параметры**:
| Параметр      | Тип   | Описание                              |
|---------------|-------|---------------------------------------|
| `study_year`  | `int` | Учебный год                           |
| `quarter`     | `int` | Номер четверти (1–4)                  |

**Возвращает**:
- Список словарей, отсортированный по убыванию среднего балла:
  - `name`: имя ученика.
  - `avg_grade`: средний балл (округлен до 2 знаков).
  - `marks_count`: количество оценок.

**Пример**:
```python
ranking = formatter.get_class_ranking(2024, 3)
for i, student in enumerate(ranking, 1):
    print(f"{i}. {student['name']}: {student['avg_grade']} (оценок: {student['marks_count']})")
```
**Вывод**:
```
1. Артём А.: 4.50 (оценок: 20)
2. Анастасия А.: 4.30 (оценок: 18)
3. София Б.: 4.10 (оценок: 15)
```

### 5. get_subject_stats
**Назначение**: Показывает, сколько оценок (2, 3, 4, 5, Н/А) выставлено по предмету всему классу.

**Параметры**:
| Параметр      | Тип   | Описание                              |
|---------------|-------|---------------------------------------|
| `study_year`  | `int` | Учебный год                           |
| `quarter`     | `int` | Номер четверти (1–4)                  |
| `subject_id`  | `int` | ID предмета (например, 630640156086198 для Биологии) |

**Возвращает**:
- Словарь, где ключи — оценки ("2", "3", "4", "5", "Н/А"), а значения — количество таких оценок.

**Пример**:
```python
stats = formatter.get_subject_stats(2024, 3, 630640156086198)
for grade, count in stats.items():
    print(f"Оценка {grade}: {count}")
```
**Вывод**:
```
Оценка 3: 13
Оценка 4: 15
Оценка 5: 70
Оценка Н/А: 7
```

### 6. get_subject_ranking
**Назначение**: Составляет рейтинг учеников по среднему баллу за предмет.

**Параметры**:
| Параметр      | Тип   | Описание                              |
|---------------|-------|---------------------------------------|
| `study_year`  | `int` | Учебный год                           |
| `quarter`     | `int` | Номер четверти (1–4)                  |
| `subject_id`  | `int` | ID предмета                           |

**Возвращает**:
- Список словарей, отсортированный по убыванию среднего балла:
  - `name`: имя ученика.
  - `avg_grade`: средний балл по предмету.
  - `marks_count`: количество оценок.

**Пример**:
```python
ranking = formatter.get_subject_ranking(2024, 3, 630640156086198)
for i, student in enumerate(ranking, 1):
    print(f"{i}. {student['name']}: {student['avg_grade']} (оценок: {student['marks_count']})")
```
**Вывод**:
```
1. Артём А.: 4.75 (оценок: 8)
2. София А.: 4.50 (оценок: 6)
3. Иван Б.: 4.20 (оценок: 7)
```

### 7. get_class_stats
**Назначение**: Показывает общую статистику успеваемости класса: количество оценок, средний балл, распределение оценок.

**Параметры**:
| Параметр      | Тип   | Описание                              |
|---------------|-------|---------------------------------------|
| `study_year`  | `int` | Учебный год                           |
| `quarter`     | `int` | Номер четверти (1–4)                  |

**Возвращает**:
- Словарь с полями:
  - `total_marks`: общее количество числовых оценок.
  - `average_class_grade`: средний балл класса.
  - `grade_distribution`: процентное распределение оценок (например, {"2": 5.0, "3": 20.0}).

**Пример**:
```python
stats = formatter.get_class_stats(2024, 3)
print(f"Оценок: {stats['total_marks']}")
print(f"Средний балл: {stats['average_class_grade']}")
for grade, percent in stats['grade_distribution'].items():
    print(f"Оценка {grade}: {percent:.2f}%")
```
**Вывод**:
```
Оценок: 1000
Средний балл: 4.20
Оценка 2: 5.00%
Оценка 3: 20.00%
Оценка 4: 35.00%
Оценка 5: 40.00%
```

## Визуализация данных
Модуль возвращает данные в формате, удобном для построения диаграмм или таблиц. Вы можете использовать сторонние библиотеки, такие как `matplotlib` или `pandas`, для визуализации.

### Пример: Построение гистограммы
```python
import matplotlib.pyplot as plt
stats = formatter.get_subject_stats(2024, 3, 630640156086198)
grades = ['2', '3', '4', '5', 'Н/А']
counts = [stats.get(grade, 0) for grade in grades]
plt.bar(grades, counts, color='skyblue')
plt.title("Оценки по Биологии")
plt.xlabel("Оценка")
plt.ylabel("Количество")
plt.savefig("biology_stats.png")
plt.close()
```

### Пример: Создание таблицы
```python
import pandas as pd
stats = formatter.get_class_stats(2024, 3)
df = pd.DataFrame(stats['grade_distribution'].items(), columns=['Оценка', 'Процент'])
df.to_csv("class_stats.csv")
print(df)
```
**Вывод**:
```
  Оценка  Процент
0      2     5.00
1      3    20.00
2      4    35.00
3      5    40.00
```

## Обработка ошибок
Модуль обрабатывает ошибки API молча, возвращая пустые результаты (`[]` или `{}`), если данные недоступны. Возможные проблемы и решения:

| Проблема                          | Решение                                                                 |
|-----------------------------------|-----------------------------------------------------------------------|
| Пустой рейтинг или статистика     | Проверьте токен: он должен иметь доступ к данным класса. Используйте токен учителя. |
| Нет данных за период              | Попробуйте другую четверть (например, `quarter=1`) или проверьте даты. |
| Ошибка "ValueError: Номер четверти" | Убедитесь, что `quarter` — число от 1 до 4.                            |
| Медленная работа                  | Добавьте кэширование оценок (см. ниже).                               |

**Кэширование для ускорения**:
```python
import json
cache_file = "marks_cache.json"
try:
    with open(cache_file, 'r') as f:
        marks_cache = json.load(f)
except FileNotFoundError:
    marks_cache = {}

# В методе, например, get_class_ranking:
cache_key = f"{student_id}_{subject_id}_{start_date}_{finish_date}"
if cache_key in marks_cache:
    marks = marks_cache[cache_key]
else:
    marks = self.api.get_person_subject_marks(student_id, subject_id, start_date, finish_date)
    marks_cache[cache_key] = marks
    with open(cache_file, 'w') as f:
        json.dump(marks_cache, f, indent=2)
```

## Ограничения
- **Доступ**: Токен ученика может не видеть оценки других учеников, что ограничивает рейтинги и статистику.
- **API**: Ограничения API Дневник.ру на количество запросов могут замедлить работу с большими классами.
- **Оценки**: Текстовые оценки (например, "отлично") преобразуются в числа (5, 4, 3, 2). Неподдерживаемые форматы игнорируются.

## Дополнительные примеры
### Получение расписания на неделю
```python
from datetime import datetime, timedelta
for i in range(7):
    date = datetime(2025, 5, 12) + timedelta(days=i)
    schedule = formatter.get_formatted_schedule(date)
    print(f"\n{date.strftime('%d.%m.%Y')}:")
    for lesson in schedule:
        print(f"  {lesson['time']} - {lesson['subject']}")
```
**Вывод**:
```
12.05.2025:
  08:30-09:15 - Биология
  09:20-10:05 - Информатика
13.05.2025:
  08:30-09:15 - Математика
```

### Сравнение успеваемости по четвертям
```python
for quarter in [1, 2, 3]:
    stats = formatter.get_class_stats(2024, quarter)
    print(f"\nЧетверть {quarter}:")
    print(f"Средний балл: {stats['average_class_grade']}")
```
**Вывод**:
```
Четверть 1:
Средний балл: 4.10
Четверть 2:
Средний балл: 4.15
Четверть 3:
Средний балл: 4.20
```

## Заключение
Модуль `DnevnikFormatter` — удобный инструмент для анализа данных Дневник.ру. Он подходит для создания отчётов, мониторинга успеваемости и составления рейтингов. Для визуализации используйте возвращаемые данные с библиотеками, такими как `matplotlib` или `pandas`. Если у вас есть вопросы или нужны доработки, обратитесь к разработчику модуля.
